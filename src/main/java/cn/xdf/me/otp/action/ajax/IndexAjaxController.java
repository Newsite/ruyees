package cn.xdf.me.otp.action.ajax;import javax.servlet.http.HttpServletRequest;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Scope;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.multipart.MultipartFile;import org.springframework.web.multipart.MultipartHttpServletRequest;import org.springframework.web.multipart.commons.CommonsMultipartResolver;import cn.xdf.me.otp.action.view.model.VOperation;import cn.xdf.me.otp.service.flow.BamIndexService;/** * 修改指标对应作业状态及上传作业 *  * @author Zaric * @date 2013-6-1 上午12:33:07 */@Controller@RequestMapping(value = "/ajax/index")@Scope("request")public class IndexAjaxController {	@Autowired	private BamIndexService bamIndexService;	@RequestMapping(value = "setUpload", method = RequestMethod.POST)	@ResponseBody	public VOperation setUpload(HttpServletRequest request) {		// 上传		String key = request.getParameter("indexId");		String fdFileName = request.getParameter("fileName");		String fdFullName = request.getParameter("fullName");		// 返回部署路径		CommonsMultipartResolver commonsMultipartResolver = new CommonsMultipartResolver(				request.getSession().getServletContext());		commonsMultipartResolver.setDefaultEncoding("utf-8");		MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;		MultipartFile file = multipartRequest.getFile("Filedata");		VOperation vOperation = bamIndexService.uploadOperation(key,				fdFileName, fdFullName, file, request, 1);		return vOperation;	}	@RequestMapping(value = "setData", method = RequestMethod.POST)	@ResponseBody	public String setThrough(HttpServletRequest request) {		// 提交		String key = request.getParameter("indexId");		String fdFileName = request.getParameter("fileName");		String fdFullName = request.getParameter("fullName");		String isSucc = bamIndexService.submitOperation(key, fdFileName,				fdFullName, 2);		return isSucc;	}}