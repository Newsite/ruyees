package ruyees.otp.action.common;import java.util.List;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.ModelMap;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.multipart.MultipartFile;import org.springframework.web.multipart.MultipartHttpServletRequest;import org.springframework.web.multipart.commons.CommonsMultipartResolver;import ruyees.otp.common.upload.FileModel;import ruyees.otp.common.upload.FileRepository;/** * 上传 * @author Zaric * @date  2013-6-1 上午12:38:22 */@Controllerpublic class UploadFileController {	/**	 * 打开上传对话框	 */	@RequestMapping("/common/o_open")	public String open(String fileName, String fullName, ModelMap model) {		model.addAttribute("fileName", fileName);		model.addAttribute("fullName", fullName);		return "/common/open";	}	/**	 * 上传文件	 */	@RequestMapping("/common/o_upload")	@ResponseBody	public FileModel execute(HttpServletRequest request,			HttpServletResponse response, ModelMap model) {		String folder = request.getParameter("folder");		CommonsMultipartResolver commonsMultipartResolver = new CommonsMultipartResolver(				request.getSession().getServletContext());		commonsMultipartResolver.setDefaultEncoding("utf-8");		MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;		MultipartFile file = multipartRequest.getFile("Filedata");		return fileRepository.storeByExt(file, folder);	}		/**	 * 上传文件	 */	@RequestMapping("/common/o_pptupload")	@ResponseBody	public List<FileModel> executeppt(HttpServletRequest request,			HttpServletResponse response, ModelMap model) {		try{			String folder = request.getParameter("folder");			CommonsMultipartResolver commonsMultipartResolver = new CommonsMultipartResolver(					request.getSession().getServletContext());			commonsMultipartResolver.setDefaultEncoding("utf-8");			MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;			MultipartFile file = multipartRequest.getFile("Filedata");			List<FileModel> fileModess = fileRepository.storeByPpt(file, folder);			return fileModess;			}catch(Exception ex){			return null;		}	}	private FileRepository fileRepository;	@Autowired	public void setFileRepository(FileRepository fileRepository) {		this.fileRepository = fileRepository;	}}